<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Files</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f7f7f7;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            max-height: 100vh;
            margin: 0;
            overflow: 100;
        }

        a {
            margin-top: 1rem;
            text-decoration: none;
            color: #fff;
            background-color: #007BFF;
            padding: 10px 20px;
            border-radius: 6px;
            transition: background-color 0.3s;
        }

        a:hover {
            background-color: #0056b3;
        }

        input[type="file"] {
            padding: 10px;
            background-color: lightgray;
            border-radius: 0.5rem;
        }

        input[type="submit"] {
            margin-top: 1rem;
            padding: 12px;
            border: none;
            border-radius: 6px;
            background-color: #28a745;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        input[type="submit"]:hover {
            background-color: #1e7e34;
        }
        
        #document-container{
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 100%;
            height: 50%;
        }

        #document-container > div{
            width: 49dvw;
            height: 50dvh;
            max-height: 50dvh;
            padding: 0.25rem;
            overflow-y: scroll;
            border: 1px solid grey;
            background-color: lightgray;
            border-radius: 0.5rem;
            box-sizing: border-box;
        }

        #original-content > embed{
            width: 100%;
            height: auto;
        }
        embed, img {
            margin-top: 1rem;
            max-width: 100%;
            max-height: 25%;
        }

        #label-container{
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            align-items: center;
        }

        #label-container > div{
            width: 49vw;
            margin-top: 1rem;
            text-align: center;
        }
    </style>
</head>

<body>
    <a href="display_files.html">Go to Display Page</a>
    <p>This file upload only accepts PDF or IMAGES at converts it to text below</p>
    <input type="file" name="file-input" id="file-input">
    <input type="submit" value="Upload" onclick="convertDocumentToText()">
    <div id="label-container">
        <div>Original File</div>
        <div>Parsed Text</div>
    </div>
    <div id="document-container">
        <div id="original-file"></div>
        <div id="document-content"></div>
    </div>
</body>
<script>
    function createSessionId() {
        return "session-" + Date.now() + "-" + Math.random().toString(36).substr(2,Â 9);
    }
    async function convertDocumentToText() {
        try {
            
            console.log("button worked")
            const content = document.getElementById("content");
            const fileInput = document.getElementById("file-input");
            const originalFile = document.getElementById("original-file")

            // fileInput.files is a FileList object (note that you can attach many files at once)
            if(fileInput.files.length === 0){
                alert("no files attached");
                return;
            }

            // can append "field name", "field value" to formData to simulate html forms
            const sessionId = createSessionId();

            const formData = new FormData();
            formData.append("file", fileInput.files[0]);
            formData.append("lang", "id"); // id, fp, my, bl, hd
            formData.append("sessionId", sessionId);

            // dont need to set headers and JSONify the formData, browser deals with it
            // its not like you know what to do as well right?
            const response = await fetch("http://127.0.0.1:8000/summary/", {
                method: "POST",
                body: formData
            });

            
            console.log("response worked")

            if (!response.ok) {
                throw new Error("Error sending request");
            }

            // display text
            const result = await response.json();
            document.getElementById("document-content").textContent = result.translated_doc;
            
            // display original file
            originalFile.innerHTML = "";
            
            // fileInput.files[0] is the file we want to process. [0] fileInput.files is a filelist
            if(fileInput.files[0].type.startsWith("image/")){
                newImg = document.createElement("img");
                newImg.src = URL.createObjectURL(fileInput.files[0]);
                originalFile.appendChild(newImg)
            } else if(fileInput.files[0].type == "application/pdf"){
                embed = document.createElement("embed");
                embed.src = URL.createObjectURL(fileInput.files[0]);
                originalFile.appendChild(embed)
            }
            console.log("all good");
        } catch (e) {
            console.error(e);
        }
    }
</script>

</html>